<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>File Handling</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
  <script class='remove'>
    "use strict";
    // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
    var respecConfig = {
      "doRDFa": false,
      "format": "markdown",
      "githubAPI": "https://api.github.com/repos/WICG/file-handling",
      "issueBase": "https://www.github.com/WICG/file-handling/issues/",
      "noLegacyStyle": true,
      "editors": [{
        name: "Eric Willigers",
        email: "ericwilligers@chromium.org",
        company: "Google Inc.",
        companyURL: "https://google.com",
      },
      {
        name: "Jay Harris",
        email: "harrisjay@chromium.org",
        company: "Google Inc.",
        companyURL: "https://google.com"
      }
        // Add additional editors here.
        // https://github.com/w3c/respec/wiki/editors
      ],
      "shortName": "file-handling",
      "specStatus": "CG-DRAFT",
      "subjectPrefix": "[file-handling]",
      "wg": "WICG",
      "otherLinks": [{
        "key": "Participate",
        "data": [{
          "value": "Github WICG/file-handling",
          "href": "https://github.com/WICG/file-handling"
        }, {
          "value": "File a bug",
          "href": "https://github.com/WICG/file-handling/issues"
        }, {
          "value": "Commit history",
          "href": "https://github.com/WICG/file-handling/commits/master"
        }, {
          "value": "Pull requests",
          "href": "https://github.com/WICG/file-handling/commits/master"
        }]
      }, {
        key: "Implementation status",
        data: [{
          value: "Chromium",
          href: "https://www.chromestatus.com/feature/5721776357113856"
        }]
      }],
    };
  </script>
</head>

<body>
  <section id="abstract">
    <h2>Abstract</h2>
    <p>
      This specification defines an API that allows websites to declare themselves as a file handler
    </p>
    <p>
      Please see the <a href="https://github.com/WICG/file-handling/blob/master/explainer.md">Explainer
        document</a>, a high-level overview of the proposal.
    </p>
  </section>
  <section id="sotd">
    <p>
      This is an early draft of the File Handing spec.
    </p>
  </section>
  <section>
    <h2>Prerequisites</h2>
    <p>

    </p>
  </section>
  <section class="informative">
    <h2>Usage Example</h2>
    <p>
      To register a site as a file handler, a <a>file_handler</a> entry is
      added to the <a data-cite="appmanifest">Web App Manifest</a>, as shown:
    </p>
    <pre class="example json" title="manifest.json">
      {
        "name": "Grafr",
        "file_handler": {
          "open_url": "/where-the-files-go",
          "files": [
            {
              "name": "raw",
              "accept": [".csv", "text/csv"]
            },
            {
              "name": "graph",
              accept: [".svg", "image/svg+xml"]
            }
          ]
        }
      }
    </pre>
    <p>
      When a launch event is triggered the application can use <code>name</code> to determine the type of file that was opened.
    </p>
    <pre class="example js" title="service-worker.js">
      self.addEventListener('launch', event => {
        event.waitUntil(async () => {
          // Try and find an existing application window.
          const allClients = await clients.matchAll();
          let client = allClients[0];
          <br/>
          // If no client is available, make a new one.
          if (!client)
            client = clients.openWindow(event.openUrl);
          <br/>
          // Pass the files to the client.
          client.postMessage(event.files);
          // And make it the active window.
          client.focus();
        });
      });
    </pre>
  </section>
  <section data-link-for="WebAppManifest">
    <h2>Extension to the Web App Manifest</h2>
    <p>
      The following IDL extends the <dfn data-cite="!appmanifest#dom-webappmanifest">WebAppManifest</dfn> dictionary.
    </p>
  </section>
</body>

</html>